# 费马小定理与素性测试

## 1. 费马小定理

若 `p` 是素数，且 `a` 与 `p` 互素，则：

`a^(p-1) ≡ 1 (mod p)`

这说明：当 `p` 是素数时，任何与 `p` 互素的 `a` 在模 `p` 意义下都会回到 1。

## 2. 证明思路（简洁而严谨）

取集合 `{1, 2, ..., p-1}`，它们在模 `p` 意义下构成一个乘法群。若 `a` 与 `p` 互素，则映射

`x -> a * x (mod p)`

是一个双射，因此乘积保持不变：

`1 * 2 * ... * (p-1) ≡ (a*1) * (a*2) * ... * (a*(p-1)) (mod p)`

右边等于 `a^(p-1) * (1*2*...*(p-1))`，消去公共因子得到 `a^(p-1) ≡ 1 (mod p)`。

## 3. 利用费马小定理做素性检验

给定一个整数 `n`：

- 选择若干个底数 `a`（如 2, 3, 5, 7, 11）。
- 计算 `a^(n-1) mod n`。
- 若存在 `a^(n-1) mod n != 1`，则 `n` 一定是合数。
- 若所有底数都满足 `a^(n-1) mod n = 1`，则 `n` **可能是素数**。

这就是费马素性测试。它很快，但并不“绝对正确”。

## 4. 伪素数（pseudoprime）

某些合数 `n` 会“伪装”为素数：对于某些底数 `a`，它们仍然满足

`a^(n-1) ≡ 1 (mod n)`

这样的 `n` 称为 **费马伪素数**。例如：

- `n = 341 = 11 * 31`
- 对 `a = 2`，有 `2^340 ≡ 1 (mod 341)`

因此，单一底数的费马测试并不可靠。

## 5. Carmichael 数

更“狡猾”的合数会通过 **所有** 与它互素的底数 `a` 的费马检验。这样的数称为 **Carmichael 数**。

最小的 Carmichael 数是：

- `561 = 3 * 11 * 17`

对任何与 561 互素的 `a`，都有 `a^560 ≡ 1 (mod 561)`。

因此，费马测试永远无法“揭穿” Carmichael 数。

## 6. 本页面算法的真实含义

本页的算法是：

- 快速排除显而易见的合数（小素数整除、偶数等）。
- 用若干个固定底数做费马测试。

所以它的判断含义是：

- **若失败：一定是合数**。
- **若通过：可能是素数，但不保证**。

这正是一个典型的“概率型素性测试”的思维方式，也是现代密码学中常见的起点。

## 7. 想更可靠怎么办？

- 使用更强的测试（如 Miller-Rabin）。
- 对小范围整数使用确定性算法（如试除或 AKS）。

本页故意使用费马小定理，是为了让你能清楚看到“数学定理 -> 算法 -> 局限”的完整路径。
